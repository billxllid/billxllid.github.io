---
title: MongoDB笔记
date: 2018-09-16 20:38:56
categories:
 - 04_学习笔记
tags:
  - mongo
  - python
  - database
---

**概述：** 记录mongoDB的一些命令语法.

 <!-- more -->

{% asset_path 20180916-MongoDB笔记 %}

# 标题

@[TOC]

## TODO

- [ ] xxx

## 安装MongoDB

我这里直接使用docker进行搭建, 参考:[docker-library/docs](https://github.com/docker-library/docs/blob/master/mongo/README.md):

``` shell
# 拉取mongo
docker pull mongo

# 运行mongod
docker run -d --name mongo \
-e MONGO_INITDB_ROOT_USERNAME=admin \
-e MONGO_INITDB_ROOT_PASSWORD=qwe123 \
some_mongo
```

使用`mongo`命令运行mongo_shell:

``` shell
# 使用mongo_shell开始学习
docker run -it --rm --name mongo_client
# --link <mongo_docker_name or id>:<alias> <image_name>
--link some_mongo:mongo mongo
# <mongo_shell> --host <mongo_host> -u <db_user> -p <user_pass> --authenticationDatabase <auth_db> <db_name>
mongo --host mongo -u admin -p qwe123 \
--authenticationDatabase admin \
test-db
```

## 帮助

``` mongo
help
```

函数帮助:

``` mongo
os.help()

// 集合的帮助
os.users.help()

// 某个函数的帮助
os.users.find().help()
```

## 基本管理

查询数据库信息:

``` mongo
show dbs
```

查询当前数据库中的集合信息:

``` mongo
show collections
```

查询基本的数据库信息:

``` mongo
db.stats()

// OUT:
{
  "db" : "tutorial",
  "collections" : 2,
  "views" : 0,
  "objects" : 22002,
  "avgObjSize" : 35.00777202072539,
  "dataSize" : 770241,
  "storageSize" : 417792,
  "numExtents" : 0,
  "indexes" : 3,
  "indexSize" : 475136,
  "fsUsedSize" : 6062329856,
  "fsTotalSize" : 62725623808,
  "ok" : 1
}
```

## 增删改查(CRUD)

本章主要记录如何新增、读取、更新和删除record(又叫文档)

切换数据库:

``` mongo
use tutorial
```

### 增(insert)

``` mongo
db.users.insert({username: "smith"})

//统计users集合中文档的数量
db.users.count()
```

### 删(remove)

删除foo集合中的所有文档:

``` mongo
db.foo.remove()
```

删除foo集合

``` mongo
db.foo.drop()
```

删除users结合中指定的文档:

``` mongo
db.users.remove({username: "jones"})
```

### 改(update)

``` mongo
db.users.update(
  {username: "jones"},
  {
    $set: {
      contry: "Canada",
      movies: ["A", "B", "C"]
    },
  }
)
```

删除movies字段:

``` mongo
db.users.update(
  {username: "jones"},
  {
    $unset: {movies: 1}
  }
)
```

更高级的更新操作(推荐):

``` mongo
db.users.update(
  {"favorites.movies": "Casablanca"},
  {
    $addToSet: {"favorites.movies": "The Maltese Falcon"},
    false,  //控制是否在没有找到该文档的时候, 插入这个字段
    true,   //控制是否全文替换, false则只替换第一个
  }
)
```

### 查(find)

``` mongo
//查询users集合(可理解为表)中的所有文档
db.users.find()
```

可以使用下面的方式将输出变得更人性化:

``` mongo
db.users.find().pretty()  //也支持条件查询
```

条件查询:

``` mongo
db.users.find({username: "smith"})
```

条件查询: `$and`、`$or`

``` mongo
db.users.find(
  {
    $and: [
      {username: "smith"},
      {_id: ObjectId("5b9e45ea0764908badc2a28a")}
    ]
  }
)
db.users.find(
  {
    $or: [
      {username: "smith"},
      {username: "jones"}
    ]
  }
)
```

条件查询:

- `$gt`: 小于
- `$lt`: 大于
- `$gte`: 下于等于
- `$lte`: 大于等于
- `$ne`: 等于

``` mongo
// 首先创建一个大集合
for(i=0; i<2000; i++){
  db.users.save({num: i})
}

// 查询num大于500的
db.users.find({num: {$gt: 500}})

// 查询20<num<50的
db.users.find({num: {$gt: 20, $lt: 50}})

// 查询20<=num<=50的
db.users.find({
  num: {
    "$gte": 20,
    "$lte": 50
  }
})
```

查询多级条目:

``` mongo
db.users.find(
  {"favorites.movies": "Casablanca"}
)
```

## 创建索引

``` mongo
db.numbers.createIndex({num: 1})
```

查询创建的索引

``` mongo
db.numbers.getIndexes()
```

## 声明

**版权：** 2018-now，:cn:，zangjiaao\<zangjiaao@yahoo.com>

由家浩创作并维护的`zangjiaao's blog`博客所有文章除特别声明外，均采用"署名-非商业性使用-相同方式共享4.0(CC BY-NC-SA 4.0)[国际许可证](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)"。

本文首发于[zangjiaao's blog](https://blog.zangjiaao.cn/)博客，转载请注明出处。
