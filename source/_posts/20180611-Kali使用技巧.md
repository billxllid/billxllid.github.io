---
title: Kali使用技巧
categories: '03_工具手册'
tags:
  - kali
  - linux
date: 2018-06-11 01:32:17
---

# Kali使用技巧

@[TOC]

## 安装 OpenVAS

参考：[Configuring and Tuning OpenVAS in Kali Linux](https://www.kali.org/tutorials/configuring-and-tuning-openvas-in-kali-linux/) 、[OpenVAS 8.0 Vulnerability Scanning](https://www.kali.org/penetration-testing/openvas-vulnerability-scanning/)、 [openVAS 官网](http://www.openvas.org/)。

使用下面方法进行安装：

```bash
root@kali:~# apt-get update
root@kali:~# apt-get dist-upgrade

root@kali:~# apt-get install openvas
root@kali:~# openvas-setup
```

### 启动停止

```bash
# 启动
root@kali:~# openvas-start
Starting OpenVas Services
Starting Greenbone Security Assistant: gsad.
Starting OpenVAS Scanner: openvassd.
Starting OpenVAS Manager: openvasmd.

# 停止
root@kali:~# openvas-stop
Stopping OpenVas Services
```

### 管理用户

运行`openvasmd –-create-user`用于添加新用户：

```bash
root@kali:~# openvasmd --create-user=dookie
User created with password 'yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyy'.
root@kali:~# openvasmd --get-users
admin
dookie
```

修改密码：

```bash
root@kali:~# openvasmd --user=dookie --new-password=s3cr3t
root@kali:~# openvasmd --user=admin --new-password=sup3rs3cr3t
```

## 安装 chrome

由于沙箱的缘故，kali 使用 chrome 需要使用 root 方式，这样就处罚了 chrome 的安全机制，需要添加参数。

安装步骤只需要进行以下几步：

1. 打开 chrome 网站，下载到.deb 安装文件；
2. 进入到下载目录，执行`dpkg --install xxx.deb`进行安装；
3. 安装过程依赖问题报错需要使用`apt-get -f install`进行修复；
4. 修复完成以后，再运行安装命令即可安装。

### 以root身份运行chrome

直接在桌面使用 root 打开 chrome 是没有反应的，因为出发了保护机制。官方说要追加`--no-sandbox`参数才能继续（我直接使用绝对路径`/opt/goole/chrome/google-chrome`打开时通过错误信息才发现的。），需要进行以下操作：

1. 使用任意文本编辑器打开文件`/opt/goole/chrome/google-chrome`，定位到最下方看到诸如以下内容:

```text
# Note: exec -a below is a bashism.
exec -a "$0" "$HERE/chrome" "$@"
```

这里只需要修改为以下内容即可：

```text
# Note: exec -a below is a bashism.
exec -a "$0" "$HERE/chrome" "$@" --no-sandbox
```

保存后重新打开即可。

### 解决打开时弹“输入密码以解锁您的登录密钥环”问题

这个问题简直是莫名其妙，输入 root 密码居然说不对..使用如下方法解决：

1. 首先在终端输入`seahorse`打开“密码与密钥”（如果命令不存在使用`apt-get install seahores`安装即可）;
2. 首先删除默认的“密码”下的“Login”或者“登录”，右键点击里面就有删除；
3. 删除完后退出，重新打开 chrome，还会弹窗，直接输入两个回车（也就是都为空）。会提示“以不加密方式存储密码吗？”，直接“继续”即可。

## 安装 proxychains+shadowsocks

主要为了挂代理干大事，更新啊啥的还是用 proxychains 快点。Kali 原生其实带 3.x 的 proxychains 的，但是版本太低不支持新版 apt 工具，所以需要改成 proxychains-ng 也就是 4.0。

step1. 首先需要删除 Kali 原生的 proxychains，使用`apt-get remove proxychains`删除。

step2. 进入[Github 地址](https://github.com/rofl0r/proxychains-ng)下载安装，官方文档介绍安装方法很清楚了，使用编译的方法安装即可：

```bash
*** Installation ***
  git clone https://github.com/rofl0r/proxychains-ng.git
  cd proxychains-ng
  # needs a working C compiler, preferably gcc
  ./configure --prefix=/usr --sysconfdir=/etc
  make
  [optional] sudo make install
  [optional] sudo make install-config (installs proxychains.conf)

  # if you dont install, you can use proxychains from the build directory like this:
  ./proxychains4 -f src/proxychains.conf telnet google.com 80
```

step3.  接下来进入[pip-shadowsocks](https://pypi.python.org/pypi/shadowsocks)安装 ss：

```bash
# Install
# Debian / Ubuntu:
apt-get install python-pip
pip install shadowsocks

# CentOS:
yum install python-setuptools && easy_install pip
pip install shadowsocks
```

step4. 添加配置文件：

```json
// /etc/shadowsocks.json
{
    "server":"207.148.26.251",
    "server_port":543,
    "local_port":1080,
    "password":"z4931568",
    "timeout":600,
    "method":"aes-256-cfb"
}

// /root/start-shadosocks.sh
sslocal -c /etc/shadowsocks.json -d start
```

step5. 启动时候会报错“loading libcrypto from libcrypto.so.1.1”的错误，这个问题是由于在 openssl1.1.0 版本中，废弃了 EVP_CIPHER_CTX_cleanup 函数。按照下面的方法调整一下：

> 1. vim /usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py (该路径请根据自己的系统情况自行修改，如果不知道该文件在哪里的话，可以使用 find 命令查找文件位置)；
>
> 2. 在 vim 中输入`:%s/cleanup/reset/g`
>
> 3. 保存并退出

step6. 修改`/etc/proxychains.conf`，最后一行换成`socks5 127.0.0.1 1080`即可完成安装。

## 安装 VMware Tools

参考[官方文档](https://docs.kali.org/general-use/install-vmware-tools-kali-guest)。

```shell
apt update && apt -y full-upgrade

# Reboot now in case you have updated to a new kernel. Once rebooted:
apt -y --reinstall install open-vm-tools-desktop fuse
reboot
```

安装完成后还需要在查看-》自动调整大小中勾选“自动适应客户机”和“自动适应窗口”

## Metasploit 自动连接 postgresql

> **简述：** Kali 自带的 Metasploit 与 ppstgresql 不会自动连接，时常出现"[-] Database not connected"的问题，为了解决这个问题需要让这俩自动连接。其他内容可参考[这边文章](http://www.mamicode.com/info-detail-1208947.html)。

1、使 Postgresql 自启动

```shell script
systemctl status postgresql
  Active: inactive (dead)

systemctl enable postgresql
  Executing: /lib/systemd/systemd-sysv-install enable postgresql

systemctl start postgresql

msfdb init
  [i] Database already started
  [+] Creating database user 'msf'
  为新角色输入的口令:
  再输入一遍:
  [+] Creating databases 'msf'
  [+] Creating databases 'msf_test'
  [+] Creating configuration file '/usr/share/metasploit-framework/config/database.yml'
  [+] Creating initial database schema

msfconsole

msf > db_status
  [*] postgresql connected to msf
```

## 系统更新失败解决办法

参考：[Kali Linux 更新失败](http://mp.weixin.qq.com/s?__biz=MjM5NjI1OTc5Mw==&mid=2652171331&idx=1&sn=02133a42d5f3438e3b88590ca2a0d0c6&chksm=bd0bbefd8a7c37ebb8f4a6c4d050490b544aa4176711e42639408b5385ffd7d202db1ef07533&mpshare=1&scene=1&srcid=030853YP3duAjZVDwjkafvhM#rd)。

报错中可以看出是由于密钥过期。首先使用查看系统里所有的密钥信息：

```bash
apt-key list
```

通过输出结果的最后一行就是导致这次问题的公钥，到期时间是 2018 年 2 月 2 日（有效期大约是 6 年）。

具体更新方法有以下几种方法：（任选一种即可）

```bash
1、
apt-key adv --keyserver keys.gnupg.net --recv-keys ED444FF07D8D0BF6

2、
wget -q -O - archive.kali.org/archive-key.asc | apt-key add

3、
gpg --keyserver hkp://pgpkeys.mit.edu --recv-key ED444FF07D8D0BF6
gpg -a --export ED444FF07D8D0BF6 | sudo apt-key add -

4、
wget https://http.kali.org/kali/pool/main/k/kali-archive-keyring/kali-archive-keyring_2018.1_all.deb
apt install ./kali-archive-keyring_2018.1_all.deb
```

## 声明

**版权：** 2018-now，:cn:，zangjiaao\<zangjiaao@yahoo.com>

由家浩创作并维护的`zangjiaao's blog`博客所有文章除特别声明外，均采用"署名-非商业性使用-相同方式共享4.0(CC BY-NC-SA 4.0)[国际许可证](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)"。

本文首发于[zangjiaao's blog](https://blog.zangjiaao.cn/)博客，转载请注明出处。